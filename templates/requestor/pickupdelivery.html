<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
     
      
		<title>{% block title %}{% endblock %}</title>
		<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
		<!-- bootstrap css -->
		<link rel="stylesheet" href="static/css/bootstrap.min.css">
      <!-- style css -->
      <link rel="stylesheet" href="static/css/style.css">
      <!-- Responsive-->
      <link rel="stylesheet" href="static/css/responsive.css">
      <!-- fevicon -->
      <link rel="icon" href="static/images/fevicon.png" type="image/gif" />
      <!-- Scrollbar Custom CSS -->
      <link rel="stylesheet" href="static/css/jquery.mCustomScrollbar.min.css">
      <!-- Tweaks for older IEs-->
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
	<style>
		table {
  	counter-reset: section;
		}
			.count:before {
  		counter-increment: section;
  		content: counter(section);
		}
		#rating-table {
    margin-top: 20px;
    width: 100%;
  }

  #rating-table td {
    padding: 10px;
  }
  input[type="radio"] {
  display: inline-block;
  margin: 0 10px 0 0;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  border: 2px solid #333;
}
#view_rating {
    text-align: center;
    margin: 50px auto;
  }
input[type="radio"]:checked {
  background-color: #333;
}

  #submit-rating-button {
    margin-top: 20px;
    padding: 10px 20px;
	width: 300px;
	text-align: center;
    background-color: #f39c12;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  
	</style>
	</head>
	<body class="main-layout">
		<header>
			<!-- header inner -->
			<div class="header">
			   <div class="header_top">
				  <div class="container">
					 <div class="row">
						<div class="col-md-3">
						   <ul class="contat_infoma">
							  <li><i class="fa fa-phone" aria-hidden="true"></i> Call : +01 12345678909</li>
						   </ul>
						</div>
						<div class="col-md-6">
						   <ul class="social_icon_top text_align_center  ">
							  <li><a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
							  <li><a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
							  <li><a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
							  <li><a href="#"><i class="fa fa-instagram" aria-hidden="true"></i></a></li>
						   </ul>
						</div>
						<div class="col-md-3">
						   <!--<ul class="contat_infoma text_align_right">
							  <li><a href="Javascript:void(0)"> <i class="fa fa-phone" aria-hidden="true"></i> demo@gmail.com</a></li>
						   </ul>-->
						   <ul class="search">
							<li><a href="Javascript:void(0)"><i class="fa fa-search" aria-hidden="true"></i></a></li>
						 </ul>
						 <!--<div class="search">
						<input type="text" name="" id="autotext">
						<label>Enter your location</label>
						 </div>-->
						</div>
					 </div>
				  </div>
			   </div>
			   <div class="container">
				  <div class="row">
					 <div class="col-md-12">
						<div class="header_bottom">
						   <div class="row">
							  <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col logo_section">
								 <div class="full">
									<div class="center-desk">
									   <div class="logo">
										  <a href="/">Bits Buddy</a>
									   </div>
									</div>
								 </div>
							  </div>
							  <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9">
								 <nav class="navigation navbar navbar-expand-md navbar-dark ">
									<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
									<span class="navbar-toggler-icon"></span>
									</button>
									<div class="collapse navbar-collapse" id="navbarsExample04">
									   <ul class="navbar-nav mr-auto">
										  <li class="nav-item ">
											 <a class="nav-link" href="/home">Home</a>
										  </li>
										  <li class="nav-item" active>
											 <a class="nav-link" href="/myorder">PickUpDelivery</a>
										  </li>
										  <li class="nav-item">
											 <a class="nav-link" href="">Appointments</a>
										  </li>
										  <li class="nav-item">
											 <a class="nav-link" href="">Field Work</a>
										  </li>
										  <li class="nav-item">
											 <a class="nav-link" href="/profile">Profile</a>
										  </li>
										  <li class="nav-item">
											<a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
										 </li>
									   </ul>
									</div>
									
								 </nav>
							  </div>
						   </div>
						</div>
					 </div>
				  </div>
			   </div>
			</div>
			<!-- end header inner -->
			<!-- end header -->
			<!-- banner -->
		 </header>
		 <!-- header -->
		 
		 <div class="back_re">
			<div class="container">
			   <div class="row">
				  <div class="col-md-12">
					 <div class="title">
						<h2>My Tasks</h2>
					 </div>
				  </div>
			   </div>
			</div>
		 </div>
         <div>
            <section class="blog-w3ls">
				
				<div class="container" id="productblog" style="width: 100%;" >
					
					<div class="table-responsive" id="table-responsive">
								<table class="table table-hover" >
									<thead>
										<tr>
											<th>Sl No</th>
											<th>Task Name</th>
											<th>Pickup location</th>
											<th>Drop off location</th>
											<th>Pickup Date</th>
											<th>Dropoff Date</th>
											<th>Status</th>
											<th style="width: 280px; text-align: center;">Worker Details</th>
										</tr>
									</thead>
									<tbody>
										{% for row in data %}
										<tr>
											<td>{{ loop.index }}</td>
											<td>{{ row.task_type }}</td>
											<td>{{ row.pickup }}</td>
											<td>{{ row.dropof }}</td>
											<td>{{ row.pickup_datetime }}</td>
											<td>{{ row.del_tentativetime }}</td>
											<td style="background-color: orange; width: 160px; padding: 16px; text-align: center; background-clip: content-box;">{{ row.status }}</td>
											<td><button type="button" class="btn btn-success" onclick="booking('{{ row.task_id }}')" style="margin-left: 60px; width: 140px;">Worker Details</button></td>
										</tr>
										{% endfor %}
										{% if data|length == 0 %}
										<tr id="no-tasks">
											<td colspan="8" style="text-align: center; font-size: larger; font-weight: bolder;">No tasks ðŸ¥³</td>
										</tr>
										{% endif %}
									</tbody>
								</table>
									  
				{% for row in data %}
				{% if not wor_rating %}
				
				<div id="view_rating" style="width: 80%; display: none;">
					<div class="border">
					  <div class="row">
						<div class="col-md-3"></div>
						<div class="col-md-6" id="prddetails1" style="text-align: center;">
						  <h3 style="font-weight: bold;">Delivery Completed!! Product reached its destinationðŸ¥³</h3>
						  <table id="rating-table">
							<tr>
							  <td style="font-weight: bold;">Please rate the worker:</td>
							  <td>
								<input type="radio" name="rating" value="1"> 1
								<input type="radio" name="rating" value="2"> 2
								<input type="radio" name="rating" value="3"> 3
								<input type="radio" name="rating" value="4"> 4
								<input type="radio" name="rating" value="5"> 5
							  </td>
							</tr>
						  </table>
						  <button id="submit-rating-button" data-task-id="{{row.task_id}}" style="margin: auto; margin-top: 30px;">Submit Rating</button>
						</div>
					  </div>
					</div>
				  </div>	
				  {% endif %}
				  {% endfor %}
				<div class="container" id="productview">
				 <div class="border">
				  <div class="row">
					  <div class="col-md-3"></div>
					  <div class="col-md-6" id="prddetails">
					  </div>
					  <div class="col-md-3"></div>
				  </div>
			    </div>
					<div class="clearfix"></div>
				</div>
			</section>
        </div>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js">
		</script>
		
		 <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
		
		 <script>
			// Check if there are no tasks in the table
			if (!document.querySelectorAll("table tbody tr").length)  {
			  document.querySelector("#no-tasks").style.display = "table-row";
			}
		  </script>
<script>
   			
function booking(id)
{
localStorage.setItem("task_id", id);
$.ajax({

            url: "/worker_details",
            type: 'POST',
            dataType: 'json',
            data: {task_id: id},
            success: function (data) {
            $("#productview").show();
            $("#productblog").hide();
            var td="";
            var cnt = 0;
for(var i=0;i<data.length;i++){

 td = "<div style=\"padding: 5%; box-shadow: 1px 6px 11px 1px #797a7a;\">\n\
				  <p style=\"text-align: center;margin-top: 4%;font-weight: 700;\">Pick & Drop details Details</p>\n\
				  <br>\n\
				  <table class=\"producttable\">\n\
					  <tr><td><b>Worker Name :</b></td><td id=\"prd\">"+data[i].username+"</td></tr>\n\
					  <tr><td><b>Phone :</b></td><td id=\"pamt\">"+data[i].phone+"</td></tr>\n\
					  <tr><td><b>Current location :</b></td><td id=\"pdes\">"+data[i].phone+"</td></tr>\n\
					  <tr><td><button type=\"button\" class=\"btn btn-info\" onclick=\"closeForm_app()\" style =\"margin-left: 92%; margin-top: 11%;\">Back</button></td></tr>\n\
				  </table>\n\
				  </div>";
    }
    $("#prddetails").empty();
    $("#prddetails").append(td);
            }
        });
}



// Submit ratings through AJAX call to Flask endpoint
$(document).ready(function() {
  // Submit ratings through AJAX call to Flask endpoint
  $("#submit-rating-button").click(function() {
    var task_id = $(this).data("task-id");
    var rating = $('input[name=rating]:checked').val();

    $.ajax({
      url: '/submit_rating_worker',
      type: 'POST',
      data: { task_id: task_id, rating: rating },
      success: function(data) {
		$("#view_rating").remove();
        alert("Ratings submitted successfully!");
		
      }
    });
  });
});	
function closeForm_app() {
    
	window.location.reload();
  }


		 </script>
		 <script>
			{% for row in data %}
			var status = "{{row.status}}";
			if (status === 'Delivery Completed') {
			  document.getElementById("view_rating").style.display = "block";
			}
			{% endfor %}
			</script>
    </body>
    </html>