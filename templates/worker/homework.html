<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
     
      
		<title>{% block title %}{% endblock %}</title>
		<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
		<!-- bootstrap css -->
		<link rel="stylesheet" href="static/css/bootstrap.min.css">
      <!-- style css -->
      <link rel="stylesheet" href="static/css/style.css">
      <!-- Responsive-->
      <link rel="stylesheet" href="static/css/responsive.css">
      <!-- fevicon -->
      <link rel="icon" href="static/images/fevicon.png" type="image/gif" />
      <!-- Scrollbar Custom CSS -->
      <link rel="stylesheet" href="static/css/jquery.mCustomScrollbar.min.css">
      <!-- Tweaks for older IEs-->
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
	  <style>
		.accept-button {
		  background-color: #0ca1a6;
		  color: white;
		  padding: 10px 20px;
		  border-radius: 5px;
		  width: 150px;
		}
		.reject-button {
		  background-color: #c0392b;
		  color: white;
		  padding: 10px 20px;
		  border-radius: 5px;
		  width: 150px;
		}
	  
		.details-button {
		  background-color: #0ca1a6;
		  color: white;
		  padding: 10px 20px;
		  border-radius: 5px;
		  width: 200px;
		}
	  
		.checkbox-label {
		  font-size: 18px;
		}
		#view_rating {
    text-align: center;
    margin: 50px auto;
  }

  

  #prddetails1 {
    text-align: left;
  }

  h3 {
    font-weight: bold;
  }

  #rating-table {
    margin-top: 20px;
    width: 100%;
  }

  #rating-table td {
    padding: 10px;
  }
  input[type="radio"] {
  display: inline-block;
  margin: 0 10px 0 0;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  border: 2px solid #333;
}

input[type="radio"]:checked {
  background-color: #333;
}

  #submit-rating-button {
    margin-top: 20px;
    padding: 10px 20px;
	width: 300px;
	text-align: center;
    background-color: #f39c12;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
	  </style>
	</head>
	<body class="main-layout">
		<header>
			<!-- header inner -->
			<div class="header">
			   <div class="header_top">
				  <div class="container">
					 <div class="row">
						<div class="col-md-3">
						   <ul class="contat_infoma">
							  <li><i class="fa fa-phone" aria-hidden="true"></i> Call : +01 12345678909</li>
						   </ul>
						</div>
						<div class="col-md-6">
						   <ul class="social_icon_top text_align_center  ">
							  <li><a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
							  <li><a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
							  <li><a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
							  <li><a href="#"><i class="fa fa-instagram" aria-hidden="true"></i></a></li>
						   </ul>
						</div>
						<div class="col-md-3">
						   <!--<ul class="contat_infoma text_align_right">
							  <li><a href="Javascript:void(0)"> <i class="fa fa-phone" aria-hidden="true"></i> demo@gmail.com</a></li>
						   </ul>-->
						   <ul class="search">
							<li><a href="Javascript:void(0)"><i class="fa fa-search" aria-hidden="true"></i></a></li>
						 </ul>
						 <!--<div class="search">
						<input type="text" name="" id="autotext">
						<label>Enter your location</label>
						 </div>-->
						</div>
					 </div>
				  </div>
			   </div>
			   <div class="container">
				  <div class="row">
					 <div class="col-md-12">
						<div class="header_bottom">
						   <div class="row">
							  <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col logo_section">
								 <div class="full">
									<div class="center-desk">
									   <div class="logo">
										  <a href="{{ url_for('homework') }}">Bits Buddy</a>
									   </div>
									</div>
								 </div>
							  </div>
							  <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9">
								 <nav class="navigation navbar navbar-expand-md navbar-dark ">
									<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
									<span class="navbar-toggler-icon"></span>
									</button>
									<div class="collapse navbar-collapse" id="navbarsExample04">
									   <ul class="navbar-nav mr-auto">
										  <li class="nav-item ">
											 <a class="nav-link" href="{{ url_for('homework') }}">Home</a>
										  </li>
										  
										  
										  <!--<li class="nav-item">
											 <a class="nav-link" href="{{ url_for('profilewo') }}">Profile</a>
										  </li>-->
										  <li class="nav-item">
											<a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
										 </li>
									   </ul>
									</div>
									
								 </nav>
							  </div>
						   </div>
						</div>
					 </div>
				  </div>
			   </div>
			</div>
			<!-- end header inner -->
			<!-- end header -->
			<!-- banner -->
		 </header>
		 <!-- header -->
		 
		 <div class="back_re">
			<div class="container">
			   <div class="row">
				  <div class="col-md-12">
					 <div class="title">
						<h2>Your tasks</h2>
					 </div>
				  </div>
			   </div>
			</div>
		 </div>
		 <!--<div style="margin-top: 10px;display: flex; justify-content: center; align-items: center; height: 100px; width: 400px; border-radius: 15px; background-color: lightgrey; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
			<a href="/worker/profilewo.html"><button style="margin: 10px; border-radius: 15px; background-color: green; width: 270px; height: 50px;">Create Profile</button>
			
		  </div>-->
		 <section class="blog-w3ls">
			<div class="container" id="productblog">
				
				<div class="table-responsive">
					<table class="table table-hover">
					  <thead>
						<tr>
						  <th>Sl No</th>
						  <th>Task Name</th>
						  <th>Pickup Location</th>
						  <th>Dropoff Location</th>
						</tr>
					  </thead>
					  <tbody>
						
									{% if data|length == 0 %}
										<tr id="no-tasks">
											<td colspan="8" style="text-align: center; font-size: larger; font-weight: bolder;">No tasks ðŸ¥³</td>
										</tr>
									{% endif %}
						<tr>
						{% for row in data %}
						  <td class="count"></td>
						  <td>{{row.task_type}}</td>
						  <td>{{row.pickup}}</td>
						  <td>{{row.dropof}}</td>
						  {% if accept %}
						  <td id="taskDetails{{row.task_id}}" >
							<button type="button" class="details-button" onclick="booking('{{row.task_id}}')" style="margin-left: 88px;">Task Details</button>
						  </td>
						  {% if not pickup %}

						  <td id="pickup{{row.task_id}}" style=" margin-left: 100px;">
							<div class="checkbox-animated">
							  <input class="checkbox-input" id="pickupCheckbox{{row.task_id}}" type="checkbox" onclick="pickupComplete('{{row.task_id}}')">
							  <label for="pickupCheckbox{{row.task_id}}">
								<span class="check"></span>
								<span class="box"></span>
								Pickup Complete
							  </label>
							</div>
						</td>
						{% endif %}
						{% if not dropoff %}
						  <td id="dropOff{{row.task_id}}" style="margin-left: 100px;">
							<div class="checkbox-animated">
							  <input class="checkbox-input" id="dropoffCheckbox{{row.task_id}}" type="checkbox" onclick="dropoffcomplete('{{row.task_id}}')">
							  <label for="dropoffCheckbox{{row.task_id}}">
								<span class="check"></span>
								<span class="box"></span>
								Dropoff Complete
							  </label>
							</div>
						</td>
						{% endif %}
						{% endif %}
						  {% if not accept %}
						  <td>
							<button type="button" class="accept-button" id="accept{{row.task_id}}" onclick="acceptRequest('{{row.task_id}}')" style="margin-left: 100px;">Accept Task</button>
							<button type="button" class="reject-button" id="reject{{row.task_id}}" onclick="rejectRequest('{{row.task_id}}')">Reject</button>
						  </td>
						  {% endif %}
						</tr>
						
					  </tbody>
					</table>
				  </div>
				</div>
				<div id="view_rating" style="width: 80%; display: none;">
					<div class="border">
					  <div class="row">
						<div class="col-md-3"></div>
						<div class="col-md-6" id="prddetails1" style="text-align: center;">
						  <h3 style="font-weight: bold;">Task Completed!!ðŸ¥³</h3>
						  <table id="rating-table">
							<tr>
							  <td style="font-weight: bold;">Submit Task Experience:</td>
							  <td>
								<input type="radio" name="rating" value="1"> 1
								<input type="radio" name="rating" value="2"> 2
								<input type="radio" name="rating" value="3"> 3
								<input type="radio" name="rating" value="4"> 4
								<input type="radio" name="rating" value="5"> 5
							  </td>
							</tr>
						  </table>
						  <button id="submit-rating-button" data-task-id="{{row.task_id}}" style="margin: auto; margin-top: 30px;">Submit Rating</button>
						</div>
					  </div>
					</div>
				  </div>
				  
				  
				  
				  
				{% endfor %}
			  
			  
			<div class="container" id="productview">
			 <div class="border">
			  <div class="row">
				  <div class="col-md-3"></div>
				  <div class="col-md-6" id="prddetails">
					</div>
					<div class="col-md-3"></div>
				 </div>
			</div>
				<div class="clearfix"></div>
			</div>

			

			
			
		</section>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js">
		</script>
		<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
		<script>
			// Check if there are no tasks in the table
			if (!document.querySelectorAll("table tbody tr").length)  {
			  document.querySelector("#no-tasks").style.display = "table-row";
			}
		  </script>
		<script>
			
			function acceptRequest(id) {
  $.ajax({
    url: '/accept_task',
    type: 'POST',
    data: { task_id: id },
    success: function(result) {
      // Handle the response here, such as updating the HTML page with the updated information
      location.reload();
    },
    error: function(error) {
      console.error(error);
    }
  });
}

		  
			
			function rejectRequest(id) {
				document.getElementById("taskDetails" + id).style.display = "block";
				document.getElementById("accept" + id).style.display = "none";
				document.getElementById("reject" + id).style.display = "none";
				document.getElementById("pickup" + id).style.display = "none";
				document.getElementById("dropOff" + id).style.display = "none";
				
				document.getElementById("reject" + id).style.display = "none";
			}	

			function pickupComplete(task_id) {
  				var pickupCheckbox = document.getElementById("pickupCheckbox" + task_id);
				
  				if (pickupCheckbox.checked) {
    			// Get the current date and time
    				var currentDate = new Date();
    				var date = currentDate.toLocaleDateString();
    				var time = currentDate.toLocaleTimeString();
    				var datetime = date + " " + time;
    
    			// Make a call to the Flask endpoint to update the MySQL field
    				$.ajax({
      						url: '/update_pickup',
      						type: 'POST',
      						data: {task_id: task_id, datetime: datetime},
      						success: function(result) {
								location.reload();
			  					
      					}
    });

  }
  			  
}
function dropoffcomplete(task_id) {
  				var dropoffCheckbox = document.getElementById("dropoffCheckbox" + task_id);
				
  				if (dropoffCheckbox.checked) {
    			
    
    			// Make a call to the Flask endpoint to update the MySQL field
    				$.ajax({
      						url: '/update_dropoff',
      						type: 'POST',
      						data: {task_id: task_id},
      						success: function(data) {
								
						      // Show the modal window
							  $("#productblog").hide();
    							$("#view_rating").show();
								
														
						
								}
							});

  }
  			  
}



// Submit ratings through AJAX call to Flask endpoint
$(document).ready(function() {
  // Submit ratings through AJAX call to Flask endpoint
  $("#submit-rating-button").click(function() {
    var task_id = $(this).data("task-id");
    var rating = $('input[name=rating]:checked').val();

    $.ajax({
      url: '/submit_ratings',
      type: 'POST',
      data: { task_id: task_id, rating: rating },
      success: function(data) {
        alert("Ratings submitted successfully!");
		location.reload();
      }
    });
  });
});	


		  </script>
		<script>
			function myFunctionpick()
			{
				button.style.visibility = "hidden";
			}
			
   
			function booking(id)
			{
			localStorage.setItem("task_id", id);
			
			$.ajax({
			
						url: "/work_details",
						type: 'POST',
						dataType: 'json',
						data: {task_id: id},
						success: function (data) {
						$("#productview").show();
						$("#productblog").hide();
						var td="";
						var cnt = 0;
						
			for(var i=0;i<data.length;i++){
			
			 td = "<div style=\"padding: 5%; box-shadow: 1px 6px 11px 1px #797a7a;\">\n\
							  <p style=\"text-align: center;margin-top: 4%;font-weight: 700;\">Task Details</p>\n\
							  <br>\n\
							  <table class=\"producttable\">\n\
								  <tr><td><b>Task Name :</b></td><td id=\"prd\">"+data[i].task_type+"</td></tr>\n\
								  <tr><td><b>Pickup Location :</b></td><td id=\"pamt\">"+data[i].pickup+"</td></tr>\n\
								  <tr><td><b>Drop Location :</b></td><td id=\"pamt\">"+data[i].dropof+"</td></tr>\n\
								  <tr><td><b>Direction :</b></td><td id=\"pdes\">"+data[i].task_type+"</td></tr>\n\
								  <tr><td><button type=\"button\" class=\"btn btn-info\" onclick=\"closeForm_app()\" style =\"margin-left: 92%; margin-top: 11%;\">Back</button></td></tr>\n\
								  </table>\n\
							  </div>";
				}
				$("#prddetails").empty();
				$("#prddetails").append(td);
						}
					});
			}
			
			


			
			function closeForm_app() {
				document.getElementById("productview").style.display = "none";
				document.getElementById("productblog").style.display = "block";
	
            }
		
		</script>
		
	</body>
</html>